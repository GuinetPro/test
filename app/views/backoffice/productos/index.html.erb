<p class="alert alert-success" role="alert" style="<%= "display:none;" if notice.nil?  %>"><%= notice %></p>
<p class="alert alert-danger" role="alert" style="<%= "display:none;" if alert.nil?  %>"><%= alert %></p> 

<h1>Lista de Productos</h1>
<% if current_usuario.perfil == "admin"  %>
<%= link_to "Nuevo Producto" , new_backoffice_producto_path , :class => "btn btn-success"%>
<% end %>
<table class="table">
  <thead>
    <tr>
      <th>Precio</th>
      <th>Activado</th>
      <th>Vigencia</th>
      <th>Vehiculo</th>
      <th>Producto</th>
      <th>Aseguradora</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @productos.each do |producto| %>
      <tr>
        <td><%= producto.precio %></td>
        <td><%= (producto.activado) ? "Si" : "No" %> </td>
        <td>
          <% producto.vigencias.each do |vi| %>
              <%= vi.tipovigencia.nombre+" ( "+ vi.fecha_desde.strftime("%Y-%m-%d")+" hasta "+ vi.fecha_hasta.strftime("%Y-%m-%d")+" )"
              %>
          <% end %> 
        </td>
        <td><%= producto.tipovehiculo.nombre %></td>
        <td><%= producto.tipoproducto.nombre %></td>
        <td><%= producto.aseguradora.nombre %></td>
        
        <% if current_usuario.perfil == "admin"  %>
          <td>
            <%= link_to 'Editar', edit_backoffice_producto_path(producto) %>  
          </td>
          <td>
            <%= link_to 'Eliminar', backoffice_producto_path(producto), method: :delete, data: { confirm: 'Realmente deseas eliminar este dato?' } %>
          </td>
            <td>
              <%= link_to "Clonar", {:controller => "backoffice/productos", :action => "duplicate", :id => producto.id }%>
            </td>
        <% end %>
        <% if current_usuario.perfil == "editor"  %>
          <td><%= link_to 'Editar', edit_backoffice_producto_path(producto) %>  </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
<%= paginate @productos, :theme => 'twitter-bootstrap-3'%>
<br>

